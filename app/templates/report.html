{% extends "citizen_base.html" %}

{% block content %}

<div class="container mt-4">
    <div class="card shadow-sm p-4">

        <h3 class="text-center mb-4">Report Garbage</h3>

        <form method="POST" enctype="multipart/form-data">

            <!-- Upload Image FIRST -->
            <div class="mb-3">
                <label class="form-label">Upload Image</label>

                <input type="file" name="image" class="form-control">

                <div class="alert alert-warning mt-2 mb-0 p-2">

                    <strong>⚠️ Important:</strong><br>

                    For better verification, uploading a real-time selfie at the location is recommended.<br>

                    Uploaded images are used only for verification purposes and will be deleted automatically within 30 days.

                </div>
            </div>


            <!-- Garbage Type -->
            <div class="mb-3">

                <label class="form-label">Garbage Type</label>

                <select name="garbage_type"
                        class="form-control"
                        required
                        onchange="toggleOtherField(this)">

                    <option value="">Select Type</option>
                    <option value="Dry Waste">Dry Waste</option>
                    <option value="Wet Waste">Wet Waste</option>
                    <option value="Other">Other</option>

                </select>

            </div>


            <!-- Only field for Other -->
            <div class="mb-3" id="otherBox" style="display:none;">

                <label class="form-label">Specify Garbage Type</label>

                <input type="text"
                       name="other_description"
                       class="form-control"
                       placeholder="Example: Medical waste, construction waste">

            </div>


            <!-- Area -->
            <div class="mb-3">

                <label class="form-label">Area</label>

                <input type="text"
                       name="area"
                       id="area"
                       class="form-control"
                       required>

            </div>


            <!-- Pincode -->
            <div class="mb-3">

                <label class="form-label">Pincode</label>

                <input type="text"
                       name="pincode"
                       id="pincode"
                       class="form-control"
                       required>

            </div>


            <!-- Landmark -->
            <div class="mb-3">

                <label class="form-label">Landmark</label>

                <input type="text"
                       name="landmark"
                       class="form-control">

            </div>


            <button type="submit"
                    class="btn btn-success w-100">

                Submit Report

            </button>

        </form>

    </div>
</div>


<script>

function toggleOtherField(select)
{
    var box = document.getElementById("otherBox");

    if(select.value === "Other")
        box.style.display = "block";
    else
        box.style.display = "none";
}



//////////////////////////////////////////////////
// AUTO GPS LOCATION — DOES NOT BREAK ANYTHING //
//////////////////////////////////////////////////

window.onload = function()
{
    getLocation();
};


function getLocation()
{
    if(navigator.geolocation)
    {
        navigator.geolocation.getCurrentPosition(
            fillLocation,
            locationError,
            { enableHighAccuracy: true }
        );
    }
}


function fillLocation(position)
{
    var lat = position.coords.latitude;
    var lon = position.coords.longitude;

    fetch(
        "https://nominatim.openstreetmap.org/reverse?format=json&lat="
        + lat +
        "&lon=" +
        lon
    )
    .then(response => response.json())
    .then(data =>
    {
        var area =
            data.address.suburb ||
            data.address.neighbourhood ||
            data.address.village ||
            data.address.town ||
            data.address.city ||
            "";

        var pincode =
            data.address.postcode || "";

        document.getElementById("area").value = area;

        document.getElementById("pincode").value = pincode;
    });
}


function locationError()
{
    console.log("Location permission denied or unavailable");
}

</script>


{% endblock %}
